@inherits Umbraco.Web.Mvc.UmbracoTemplatePage<ContentModels.LabMember>
@using ContentModels = Umbraco.Web.PublishedContentModels;
@{
	Layout = "umbLayout.cshtml";
	
	var projects = CurrentPage.Site().Descendants("researchProject").Where("Visible").OrderBy("Name");
	var tools = CurrentPage.Site().FirstChild("toolIndex").Children.Where("Visible");
	var pageId = CurrentPage.Id.ToString();
	
	var endDate = CurrentPage.GetPropertyValue<DateTime>("endDate");
	var startDate = CurrentPage.GetPropertyValue<DateTime>("startDate");
	var month = (endDate.Month - startDate.Month) + 12 * (endDate.Year - startDate.Year);
	var years = Math.Floor((double)month / (double)12);
	var months = month % 12;
	bool hasLeft = endDate != new DateTime();
}

<div class="container">
	@{ Html.RenderPartial("breadcrumb"); }
	<div class="page-header">
		<h1>@Umbraco.Field("title") @Umbraco.Field("firstName") @Umbraco.Field("middleInitials") @Umbraco.Field("surname")
		@if (!hasLeft) {
		<small>@Umbraco.Field("labPosition")</small>
		}
		</h1>
		<h4><span class="glyphicon glyphicon-calendar"></span> At OxLEL for @if (years != 0) { Html.Raw(years + "years and"); } @months months. @if (!hasLeft) { Html.Raw("Left " + endDate.Month + "/" + endDate.Year);}</h4>
	</div>
		
	<div class="row">
	<div class="col-md-8">			
		<h4>Academic Profile</h4>
		<hr/>
		@Umbraco.Field("researchProfile")
		@if (!hasLeft) {
					<h4>Current Research</h4>
		<hr/>
				@Umbraco.Field("currentResearch")
		<h4>Selected Publications</h4>
		<hr/>
		@Umbraco.Field("publications")

		}
	</div>
		
	<div class="col-md-4">
		<img src="@Model.Content.GetCropUrl("picture", "portrait")" alt="Portrait" style="width:100%"/>
		<ul class="related-links">
		@if (!hasLeft && !string.IsNullOrEmpty(Umbraco.Field("emailAddress").ToString())) {
				<li><a href="mailto:@Umbraco.Field("emailAddress")"><i class="fa fa-envelope"></i> Email</a></li>
		}
		@if (!hasLeft && !string.IsNullOrEmpty(Umbraco.Field("twitter").ToString())) {
				<li><a href="mailto:@Umbraco.Field("twitter")"><i class="fa fa-twitter"></i> Twitter</a></li>
		}
		@if (!hasLeft && !string.IsNullOrEmpty(Umbraco.Field("personalWebsite").ToString())) {
				<li><a href="@Umbraco.Field("personalWebsite")" target="_blank"><i class="fa fa-link"></i> Personal Website</a></li>
		}
		@if (!hasLeft && !string.IsNullOrEmpty(Umbraco.Field("github").ToString())) {
				<li><a href="https://github.com/@Umbraco.Field("github")" target="_blank"><i class="fa fa-github"></i> GitHub</a></li>
		}
		@if (!hasLeft && !string.IsNullOrEmpty(Umbraco.Field("oRCIDID").ToString())) {
				<li><a href="http://orcid.org/@Umbraco.Field("oRCIDID")" target="_blank">Research on ORCID</a></li>
		}
		@if (hasLeft && !string.IsNullOrEmpty(Umbraco.Field("newWebsite").ToString())) {
				<li><a href="@Umbraco.Field("newWebsite")" target="_blank">New Web Address</a></li>
		}
		</ul>
		<hr/>
			@if (!hasLeft){
		<div class="panel panel-primary">
			<div class="panel-heading">
			<h3 class="panel-title">Active Research</h3>
			</div>
			<div class="panel-body">
				@foreach (var project in projects) {
					var peopleValue = project.GetPropertyValue<string>("people");
					if (peopleValue.Contains(pageId)) {
											<p>
							<a href="@project.Url">@project.GetPropertyValue("projectTitle")</a>
						</p>
					}
					}
			</div>
		</div>
		<div class="panel panel-primary">
			<div class="panel-heading">
				<h3 class="panel-title">Tools and Resources</h3>
			</div>
			<div class="panel-body">
			@foreach (var tool in tools) {
									var peopleValue = tool.GetPropertyValue<string>("people");
					if (peopleValue.Contains(pageId)) {
					<p>
						<a href="@tool.Url">@tool.GetPropertyValue("toolName")</a>
					</p>
				}
			}
			</div>
			
		</div>
			}
	</div>
				</div>